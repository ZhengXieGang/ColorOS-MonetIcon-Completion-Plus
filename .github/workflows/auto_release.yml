name: Icon Update Release

permissions:
  contents: write

on:
  push:
    paths:
      - 'uxicons/**' # 仅当 uxicons 文件夹变动时触发
    branches:
      - main # 确保你的主分支叫 main，如果是 master 请修改

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Calculate Icon Count & Version
        id: version
        run: |
          # 计算文件数量 (仅计算文件，不包含文件夹)
          count=$(find uxicons -maxdepth 1 -type f | wc -l)
          # 去除空格
          count=$(echo $count | xargs)
          # 格式化版本号，例如 58 -> v0.0058
          version=$(printf "v0.%04d" $count)
          
          echo "Current Icon Count: $count"
          echo "Generated Version: $version"
          
          # 导出变量供后续步骤使用
          echo "ICON_COUNT=$count" >> $GITHUB_OUTPUT
          echo "VERSION_TAG=$version" >> $GITHUB_OUTPUT

      - name: Zip uxicons folder
        run: |
          # 压缩 uxicons 文件夹
          zip -r uxicons.zip uxicons

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ steps.version.outputs.VERSION_TAG }}
          name: "Icon Update ${{ steps.version.outputs.VERSION_TAG }}"
          files: uxicons.zip
          prerelease: true # 标记为 Pre-release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
